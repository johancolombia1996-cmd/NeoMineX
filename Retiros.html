<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NeoMineX - Retiro USDT</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#030617;
  --card:rgba(8,14,23,0.82);
  --accent1:#06b6d4;
  --accent2:#0ea5e9;
  --neon:#0ef;
  --muted:rgba(230,247,251,0.72);
  --radius:14px;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family:'Poppins',sans-serif;
  background:
    radial-gradient(800px 300px at 10% 10%, rgba(14,165,233,0.04), transparent 10%),
    radial-gradient(600px 250px at 90% 90%, rgba(6,182,212,0.03), transparent 10%),
    var(--bg);
  color:#e6f7fb;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  overflow-x:hidden;
  padding:22px;
}

/* Top icons */
.top-left{
  position:fixed;top:18px;left:18px;
  font-size:26px;color:var(--neon);cursor:pointer;z-index:60;
  transition:transform .18s ease;
}
.top-left:hover{transform:translateX(-6px) scale(1.04);}

.top-right{
  position:fixed;top:16px;right:18px;display:flex;gap:12px;align-items:center;z-index:60;
}
.notebook{
  font-size:22px;color:var(--accent2);cursor:pointer;transition:transform .18s ease;
}
.notebook:hover{transform:scale(1.06)}
.profile-m{
  width:44px;height:44px;border-radius:50%;
  background:linear-gradient(145deg,#06b6d4,#0ea5e9);
  display:flex;align-items:center;justify-content:center;font-weight:800;color:#000;
  box-shadow:0 0 12px rgba(14,165,233,0.45),0 0 28px rgba(6,182,212,0.12);
  animation:spin 7s linear infinite, glow 2s ease-in-out infinite alternate;
  cursor:default;
}
@keyframes spin{from{transform:rotate(0deg)}to{transform:rotate(360deg)}}
@keyframes glow{from{box-shadow:0 0 12px rgba(14,165,233,0.45)}to{box-shadow:0 0 22px rgba(6,182,212,0.7)}}

/* Layout center card */
.wrapper{max-width:980px;margin:96px auto 40px;padding:0 16px;}
.card{
  background:var(--card);border-radius:16px;padding:20px;border:1px solid rgba(255,255,255,0.03);
  box-shadow:0 30px 60px rgba(2,6,23,0.6);backdrop-filter:blur(6px);
}
.head{
  display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;
}
.title{font-size:20px;color:var(--accent1);font-weight:700}
.row{display:flex;gap:18px;flex-wrap:wrap}
.col{flex:1;min-width:260px}

/* Info boxes */
.infoBox{
  background:linear-gradient(90deg, rgba(6,182,212,0.04), rgba(14,165,233,0.02));
  border-radius:10px;padding:10px;border:1px solid rgba(255,255,255,0.02);
  color:#dff9ff;font-weight:700;margin-bottom:10px;
}
.idField{display:flex;align-items:center;gap:10px}
.idText{background:rgba(0,0,0,0.2);padding:8px 10px;border-radius:8px;color:var(--muted);font-weight:700}

/* Form */
.form{
  display:flex;flex-direction:column;gap:10px;
  margin-top:6px;
}
label{font-size:13px;color:var(--muted);font-weight:600;margin-bottom:4px}
.input, .readonly{
  width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
  background:rgba(255,255,255,0.02);color:#e6f7fb;font-weight:600;font-size:14px;
}
.readonly{background:rgba(255,255,255,0.01);opacity:0.95}
.small{font-size:13px;color:var(--muted)}

/* Actions */
.actions{display:flex;gap:10px;align-items:center;margin-top:8px}
.btn{
  background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;padding:10px 16px;border-radius:10px;
  cursor:pointer;color:#000;font-weight:800;box-shadow:0 8px 30px rgba(6,182,212,0.08);
}
.btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:700}

/* Modal history */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;
  opacity:0;visibility:hidden;transition:opacity .2s ease,visibility .2s ease;z-index:80;
}
.modal.show{opacity:1;visibility:visible}
.modal-card{width:92%;max-width:520px;background:var(--card);border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.04);position:relative}
.modal-close{position:absolute;top:10px;right:12px;font-size:18px;cursor:pointer;color:var(--muted)}
.history-item{padding:10px;border-bottom:1px dashed rgba(255,255,255,0.03);color:var(--neon);font-weight:700}
.history-empty{color:var(--muted);padding:18px;text-align:center}

/* Footer warning */
.footer-note{
  margin-top:14px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);
  color:#ffd0d0;font-size:13px;border:1px solid rgba(255,100,100,0.03)
}

/* responsive */
@media(max-width:760px){
  .row{flex-direction:column}
}
</style>
</head>
<body>

<!-- Top-left back arrow -->
<div class="top-left" onclick="goHome()" title="Volver">‚¨Ö</div>

<!-- Top-right icons: notebook + spinning M (perfil) -->
<div class="top-right">
  <div class="notebook" title="Historial" onclick="openHistory()">üìí</div>
  <div class="profile-m" title="Perfil">M</div>
</div>

<div class="wrapper">
  <div class="card">
    <div class="head">
      <div class="title">Retiro USDT TRC20</div>
      <div class="small">Retiro m√≠nimo: <strong style="color:var(--neon)">1 USDT</strong></div>
    </div>

    <div class="row">
      <!-- Left column: summary + form -->
      <div class="col">
        <div class="infoBox">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small">ID de Usuario</div>
              <div class="idField" style="margin-top:6px">
                <div class="idText" id="userId">--</div>
              </div>
            </div>
            <div style="text-align:right">
              <div class="small">Saldo Disponible</div>
              <div style="font-weight:800;color:var(--neon);margin-top:6px" id="balanceText">0.00 USDT</div>
              <div class="small" style="margin-top:6px">Total recargas: <span id="recargasTotal">0.00</span> USDT</div>
            </div>
          </div>
        </div>

        <form class="form" id="withdrawForm" onsubmit="return false;">
          <div>
            <label for="address">Direcci√≥n de retiro</label>
            <input id="address" class="input" placeholder="Ingrese direcci√≥n TRC20 (empieza con T)" autocomplete="off" />
            <div class="small" style="margin-top:6px;color:var(--muted)">Ejemplo: TJ6QaxbDeK2sHbeTLWjKFdqiG4eiCaivNu</div>
          </div>

          <div>
            <label for="password">Contrase√±a</label>
            <input id="password" type="password" class="input" placeholder="Tu contrase√±a de cuenta" autocomplete="off" />
            <div class="small" style="margin-top:6px;color:var(--muted)">Si a√∫n no tienes contrase√±a crea una desde Historial ‚Üí "Crear contrase√±a".</div>
          </div>

          <div>
            <label for="amount">Cantidad (USDT)</label>
            <input id="amount" type="number" step="0.01" min="0" class="input" placeholder="Ej: 10.00" />
          </div>

          <div class="actions">
            <button class="btn" onclick="handleWithdraw()">Retirar</button>
            <button class="btn secondary" onclick="goRecharge()">Ir a Recarga</button>
          </div>
        </form>
      </div>

      <!-- Right column: history quick + note -->
      <div class="col">
        <div style="border-radius:10px;padding:12px;background:linear-gradient(90deg,rgba(255,255,255,0.01),transparent);border:1px solid rgba(255,255,255,0.02)">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="font-weight:700;color:var(--accent1)">√öltimos retiros</div>
            <div class="small" style="color:var(--muted)">Actualizado</div>
          </div>
          <div id="recentList">
            <div class="history-empty">No hay retiros registrados.</div>
          </div>

          <div style="margin-top:12px">
            <button class="btn secondary" onclick="openHistory()">Ver historial completo</button>
          </div>
        </div>

        <div class="footer-note" style="margin-top:12px">
          <strong>Importante:</strong> Si retiras y no colocaste correctamente tu direcci√≥n de dep√≥sito, los activos se <strong>perder√°n</strong> y tu saldo se <strong>descontar√°</strong> en cuanto se procese el retiro. Revisa la direcci√≥n cuidadosamente antes de confirmar.
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Modal: historial y crear contrase√±a -->
<div id="modal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <span class="modal-close" onclick="closeHistory()">‚úñ</span>
    <h3 id="modalTitle" style="color:var(--accent1);margin-bottom:10px">Historial de retiros</h3>

    <div id="historyContainer"></div>

    <div style="margin-top:14px;display:flex;gap:10px;justify-content:center">
      <button class="btn secondary" onclick="closeHistory()">Cerrar</button>
      <button class="btn" onclick="openSetPassword()">Crear / Cambiar contrase√±a</button>
    </div>

    <!-- Create Password Area (inline in modal) -->
    <div id="setPassArea" style="margin-top:12px;display:none">
      <div style="margin-bottom:8px"><label class="small">Nueva contrase√±a:</label>
        <input id="newPass" class="input" type="password" placeholder="Nueva contrase√±a"></div>
      <div style="margin-bottom:8px"><label class="small">Repetir contrase√±a:</label>
        <input id="confirmPass" class="input" type="password" placeholder="Repetir contrase√±a"></div>
      <div style="display:flex;gap:8px;justify-content:center">
        <button class="btn" onclick="savePassword()">Guardar</button>
        <button class="btn secondary" onclick="cancelSetPassword()">Cancelar</button>
      </div>
    </div>

  </div>
</div>

<script>
/* ----------------------
  Persistencia (localStorage)
   - userId: neominex_user_id (string)
   - balance: neominex_balance (float)
   - recargasTotal: neominex_recargas_total (float)
   - withdrawals: neominex_withdrawals (JSON array)
   - password: neominex_pass (string)  <-- almacenado en claro (cliente)
---------------------- */

const LS_USER = 'neominex_user_id';
const LS_BAL  = 'neominex_balance';
const LS_REC  = 'neominex_recargas_total';
const LS_W    = 'neominex_withdrawals';
const LS_PASS = 'neominex_pass';

// Utilidades
function genId(len=12){
  const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let s='';
  for(let i=0;i<len;i++) s += chars[Math.floor(Math.random()*chars.length)];
  return s;
}
function getLS(key, fallback){
  const v = localStorage.getItem(key);
  if(v===null) return fallback;
  try { return JSON.parse(v); } catch(e){ return v; }
}
function setLS(key, value){
  localStorage.setItem(key, JSON.stringify(value));
}

/* Inicializaci√≥n */
let userId = localStorage.getItem(LS_USER);
if(!userId){
  userId = genId(12);
  localStorage.setItem(LS_USER, userId);
}
let balance = parseFloat(localStorage.getItem(LS_BAL) ?? 5.00); // default 5 USDT
let recargasTotal = parseFloat(localStorage.getItem(LS_REC) ?? 0.00);
let withdrawals = JSON.parse(localStorage.getItem(LS_W) || '[]');
let storedPass = localStorage.getItem(LS_PASS) || null;

/* DOM referencias */
const userIdEl = document.getElementById('userId');
const balanceText = document.getElementById('balanceText');
const recargasText = document.getElementById('recargasTotal');
const recentList = document.getElementById('recentList');
const modal = document.getElementById('modal');
const historyContainer = document.getElementById('historyContainer');

/* Mostrar valores */
function refreshUI(){
  userIdEl.textContent = userId;
  balanceText.textContent = balance.toFixed(2) + ' USDT';
  recargasText.textContent = recargasTotal.toFixed(2);
  renderRecent();
}
function renderRecent(){
  if(!withdrawals || withdrawals.length === 0){
    recentList.innerHTML = '<div class="history-empty">No hay retiros registrados.</div>';
  } else {
    const last = withdrawals.slice(-4).reverse();
    recentList.innerHTML = last.map(r=>`
      <div style="padding:8px;border-bottom:1px dashed rgba(255,255,255,0.03);">
        <div style="font-weight:700;color:var(--neon)">${r.monto.toFixed(2)} USDT</div>
        <div class="small" style="color:var(--muted)">${r.fecha}</div>
      </div>
    `).join('');
  }
}

/* Navegaci√≥n */
function goHome(){ window.location.href = "https://johancolombia1996-cmd.github.io/NeoMineX/NeoMineX%20-%20Home.html"; }
function goRecharge(){ window.location.href = "https://johancolombia1996-cmd.github.io/NeoMineX/recarga.html"; } // ajusta si tu URL difiere

/* Abrir/Cerrar historial modal */
function openHistory(){
  populateHistory();
  modal.classList.add('show');
}
function closeHistory(){
  modal.classList.remove('show');
  hideSetPassArea();
}

/* Populate historial */
function populateHistory(){
  const list = JSON.parse(localStorage.getItem(LS_W) || '[]');
  if(!list || list.length === 0){
    historyContainer.innerHTML = '<div class="history-empty">No hay retiros registrados.</div>';
  } else {
    historyContainer.innerHTML = list.slice().reverse().map(r=>`
      <div class="history-item">
        ${r.monto.toFixed(2)} USDT ‚Äî ${r.fecha} ‚Äî 
        <div style="font-weight:600;color:#cfeef6">${r.to}</div>
      </div>
    `).join('');
  }
}

/* Crear/guardar contrase√±a */
function openSetPassword(){
  document.getElementById('setPassArea').style.display = 'block';
}
function cancelSetPassword(){
  document.getElementById('setPassArea').style.display = 'none';
}
function hideSetPassArea(){
  document.getElementById('setPassArea').style.display = 'none';
}
function savePassword(){
  const np = document.getElementById('newPass').value;
  const cp = document.getElementById('confirmPass').value;
  if(!np || np.length < 4){ alert('La contrase√±a debe tener al menos 4 caracteres.'); return; }
  if(np !== cp){ alert('Las contrase√±as no coinciden.'); return; }
  localStorage.setItem(LS_PASS, np);
  storedPass = np;
  alert('‚úÖ Contrase√±a guardada.');
  hideSetPassArea();
}

/* Validaciones y retiro */
function handleWithdraw(){
  const address = document.getElementById('address').value.trim();
  const pass = document.getElementById('password').value;
  const amountVal = parseFloat(document.getElementById('amount').value);

  if(isNaN(amountVal) || amountVal <= 0){
    alert('Introduce una cantidad v√°lida.');
    return;
  }
  if(amountVal < 1){
    alert('‚ö†Ô∏è El monto m√≠nimo de retiro es 1 USDT.');
    return;
  }
  if(amountVal > balance){
    alert('‚ùå No tienes balance suficiente.');
    return;
  }
  // Password check
  const stored = localStorage.getItem(LS_PASS);
  if(stored){
    if(!pass){ alert('Ingresa tu contrase√±a.'); return; }
    if(pass !== stored){ alert('‚ùå Contrase√±a incorrecta.'); return; }
  } else {
    // no password stored -> ask to create first
    if(!pass){ 
      const c = confirm('No tienes contrase√±a establecida. ¬øDeseas crearla ahora usando la contrase√±a ingresada? (Se almacenar√° en este navegador).');
      if(!c) return;
      if(pass.length < 4){ alert('La contrase√±a debe tener al menos 4 caracteres.'); return; }
      localStorage.setItem(LS_PASS, pass);
      storedPass = pass;
      alert('‚úÖ Contrase√±a creada y guardada localmente.');
    } else {
      // user entered a pass but none stored: create automatically after confirm
      const c = confirm('No existe contrase√±a guardada. ¬øDeseas utilizar la que ingresaste como contrase√±a de la cuenta?');
      if(!c) return;
      if(pass.length < 4){ alert('La contrase√±a debe tener al menos 4 caracteres.'); return; }
      localStorage.setItem(LS_PASS, pass);
      storedPass = pass;
      alert('‚úÖ Contrase√±a creada y guardada localmente.');
    }
  }

  // address validation: TRC addresses start with 'T' and length ~34, but we'll be lenient
  let addressLooksOk = (address && address[0] === 'T' && address.length >= 20);
  if(!addressLooksOk){
    const cont = confirm('La direcci√≥n ingresada parece inv√°lida o incompleta. Si contin√∫as, tus activos podr√≠an perderse. ¬øDeseas continuar de todos modos?');
    if(!cont) return;
  }

  // Proceed withdrawal: deduct balance, create record
  balance = +(balance - amountVal);
  recargasTotal = parseFloat(localStorage.getItem(LS_REC) ?? 0.00); // keep recargas total unchanged here
  // Create record
  const now = new Date();
  const record = {
    id: 'W-' + Math.floor(Math.random()*900000 + 100000),
    monto: +amountVal,
    fecha: now.toLocaleString(),
    to: address || '(no especificada)',
    status: 'En proceso'
  };
  withdrawals.push(record);
  // persist
  localStorage.setItem(LS_BAL, balance.toFixed(2));
  localStorage.setItem(LS_W, JSON.stringify(withdrawals));
  // Update UI
  refreshUI();
  populateHistory();
  alert('‚úÖ Tu retiro est√° en proceso. Revisa el historial para m√°s detalles.');
  // Clear form fields
  document.getElementById('address').value = '';
  document.getElementById('amount').value = '';
  document.getElementById('password').value = '';
}

/* Inicial UI */
refreshUI();

/* Exponer funciones al modal global scope */
window.openHistory = openHistory;
window.closeHistory = closeHistory;
window.goHome = goHome;
window.openSetPassword = openSetPassword;
window.cancelSetPassword = cancelSetPassword;
window.savePassword = savePassword;
window.handleWithdraw = handleWithdraw;
window.goRecharge = goRecharge;
</script>
</body>
</html>
